<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi Tiết Sản Phẩm - {{ fruit.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>{{ fruit.name }}</h1>
        <div class="product-detail">
            <img src="{{ fruit.image_url }}" alt="{{ fruit.name }}" class="product-image">
            <p><strong>Giá:</strong> {{ fruit.price }}</p>
            <a href="{{ fruit.original_link }}" target="_blank" class="detail-link">Xem chi tiết sản phẩm</a>
            <div class="summary-box">
                <h3>Tóm tắt sản phẩm</h3>
                <form method="POST" id="summary-form">
                    <label for="format" class="form-label">Nhập định dạng tóm tắt (ví dụ: - Xuất xứ: ...):</label>
                    <textarea name="format" class="form-control format-textarea" placeholder="Nhập định dạng tóm tắt mong muốn" required></textarea>
                    <button type="submit" class="btn btn-primary mt-2">Tóm tắt</button>
                </form>
                <!-- Hiệu ứng loading -->
                <div class="loading" id="loading">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Đang tải...</span>
                    </div>
                    <p>Đang xử lý tóm tắt...</p>
                </div>
                <!-- Flash messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
                {% if summary %}
                    {% for line in summary.split('\n') %}
                        <p>{{ line | trim }}</p>
                    {% endfor %}
                {% else %}
                    <p>Chưa có tóm tắt. Vui lòng nhập định dạng và nhấn "Tóm tắt".</p>
                {% endif %}
            </div>
            <a href="{{ url_for('index') }}" class="detail-link">Quay lại danh sách</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('summary-form').addEventListener('submit', function() {
            document.getElementById('loading').classList.add('active');
        });
    </script>
</body>
</html>
